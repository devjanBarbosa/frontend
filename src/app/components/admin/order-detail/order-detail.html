<div class="page-container" *ngIf="pedido; else loadingOrError">
  <header class="page-header">
    <a routerLink="/admin/pedidos" class="back-button">
      <i class="bi bi-arrow-left"></i>
      <span>Voltar para Pedidos</span>
    </a>
    <div class="header-content">
      <h1>Pedido #{{ pedido.id.substring(0, 8) }}</h1>
      <span class="status-badge" [ngClass]="pedido.status.toLowerCase()">{{ pedido.status.replace('_', ' ') }}</span>
    </div>
    <div class="header-actions">
      <a [href]="'https://wa.me/' + pedido.whatsappCliente" target="_blank" class="btn btn-secondary">
        <i class="bi bi-whatsapp"></i> Falar com Cliente
      </a>
      <button class="btn btn-secondary" (click)="imprimirPedido()">
        <i class="bi bi-printer"></i> Imprimir
      </button>
    </div>
  </header>

  <main class="order-layout">
    <div class="main-column">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-box-seam"></i>
          <h3>Itens do Pedido ({{ pedido.itens.length }})</h3>
        </div>
        <ul class="item-list">
          <li *ngFor="let item of pedido.itens" class="item-list-row">
            <div class="item-product-info">
              <span class="item-quantity">{{ item.quantidade }}x</span>
              <span class="item-name">{{ item.nomeProduto }}</span>
            </div>
            <div class="item-pricing">
              <span class="item-unit-price">{{ item.precoUnitario | currency:'BRL' }}</span>
              <span class="item-subtotal">{{ (item.quantidade * item.precoUnitario) | currency:'BRL' }}</span>
            </div>
          </li>
        </ul>
        <div class="order-total-summary">
          <span>Total do Pedido</span>
          <strong>{{ pedido.valorTotal | currency:'BRL' }}</strong>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <i class="bi bi-truck"></i>
          <h3>Entrega e Pagamento</h3>
        </div>
        <div class="details-grid">
          <div class="detail-item">
            <span class="detail-label">Método de Entrega</span>
            <span class="detail-value">{{ pedido.tipoEntrega === 'ENTREGA_LOCAL' ? 'Delivery' : 'Retirada na Loja' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Método de Pagamento</span>
            <span class="detail-value">{{ pedido.metodoPagamento }}</span>
          </div>
          <div class="detail-item full-width" *ngIf="pedido.tipoEntrega === 'ENTREGA_LOCAL'">
            <span class="detail-label">Endereço de Entrega</span>
            <span class="detail-value">
              {{ pedido.endereco }}, {{ pedido.numero }} {{ pedido.complemento ? '- ' + pedido.complemento : '' }}<br>
              {{ pedido.bairro }} - CEP: {{ pedido.cep }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <aside class="sidebar-column">
      <div class="card">
        <div class="card-header">
          <i class="bi bi-toggles"></i>
          <h3>Gerenciar Status</h3>
        </div>
        <div class="card-body">
          <p>Selecione o novo status do pedido:</p>
          <select class="form-select" [(ngModel)]="statusSelecionado">
            <option *ngFor="let status of listaDeStatus" [value]="status">
              {{ formatarStatus(status) }}
            </option>
          </select>
          <button class="btn btn-primary" (click)="atualizarStatus()" [disabled]="statusSelecionado === pedido.status">
            Salvar Alteração
          </button>
        </div>
      </div>
    </aside>
  </main>
</div>

<ng-template #loadingOrError>
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>A carregar detalhes do pedido...</p>
  </div>
  <div *ngIf="!isLoading && !pedido" class="not-found-container">
    <i class="bi bi-exclamation-triangle"></i>
    <h3>Pedido não encontrado</h3>
    <p>O pedido que você procura não existe ou o ID é inválido.</p>
  </div>
</ng-template>